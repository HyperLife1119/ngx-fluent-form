<ng-template let-control="control" let-schema="schema" let-model="model" [fluentContextGuard]="contextGuard">
  <ng-container *fluentInject="NzInputGroup as inputGroup; optional: true">
    <ng-container *ngIf="schema.autocomplete as autocomplete; else noAutocompleteTemplate">
      <ng-container *ngIf="inputGroup; else standardTemplate">
        <input
          *ngIf="!(schema.hidden | reactive: model:schema:control)"
          nz-col
          nz-input
          [attr.id]="schema.id"
          [attr.name]="schema.key"
          [attr.maxlength]="helper.length.max | invoke: schema.length"
          [attr.minlength]="helper.length.min | invoke: schema.length"
          [fluentBinding]="{ schema, control }"
          [formControl]="control"
          [ngClass]="schema.class"
          [ngStyle]="schema.style"
          [nzSpan]="schema.col | col: 'span'"
          [nzFlex]="schema.col | col: 'flex'"
          [nzOffset]="schema.col | col: 'offset'"
          [nzPush]="schema.col | col: 'push'"
          [nzPull]="schema.col | col: 'pull'"
          [nzOrder]="schema.col | col: 'order'"
          [nzAutocomplete]="autocompleteComponent"
          [placeholder]="schema.placeholder ?? ''"
          [type]="schema.type ?? 'text'"
          [autofocus]="schema.autofocus"
          [readonly]="schema.readonly | reactive: model:schema:control"
          [nzSize]="schema.size!"
          [nzBorderless]="schema.borderless" />
      </ng-container>

      <ng-template #standardTemplate>
        <input
          nz-input
          [attr.id]="schema.id"
          [attr.name]="schema.key"
          [attr.maxlength]="helper.length.max | invoke: schema.length"
          [attr.minlength]="helper.length.min | invoke: schema.length"
          [fluentBinding]="{ schema, control }"
          [ngClass]="schema.class"
          [ngStyle]="schema.style"
          [formControl]="control"
          [nzAutocomplete]="autocompleteComponent"
          [placeholder]="schema.placeholder ?? ''"
          [type]="schema.type ?? 'text'"
          [autofocus]="schema.autofocus"
          [readonly]="schema.readonly | reactive: model:schema:control"
          [nzSize]="schema.size!"
          [nzBorderless]="schema.borderless" />
      </ng-template>

      <nz-autocomplete
        #autocompleteComponent
        [compareWith]="helper.autocomplete.compare | invoke: autocomplete"
        [nzBackfill]="autocomplete.backfill"
        [nzDataSource]="autocomplete.options"
        [nzWidth]="autocomplete.width"></nz-autocomplete>
    </ng-container>

    <ng-template #noAutocompleteTemplate>
      <ng-container *ngIf="inputGroup; else standardTemplate">
        <input
          *ngIf="!(schema.hidden | reactive: model:schema:control)"
          nz-col
          nz-input
          [attr.id]="schema.id"
          [attr.name]="schema.key"
          [attr.maxlength]="helper.length.max | invoke: schema.length"
          [attr.minlength]="helper.length.min | invoke: schema.length"
          [fluentBinding]="{ schema, control }"
          [formControl]="control"
          [ngClass]="schema.class"
          [ngStyle]="schema.style"
          [nzSpan]="schema.col | col: 'span'"
          [nzFlex]="schema.col | col: 'flex'"
          [nzOffset]="schema.col | col: 'offset'"
          [nzPush]="schema.col | col: 'push'"
          [nzPull]="schema.col | col: 'pull'"
          [nzOrder]="schema.col | col: 'order'"
          [placeholder]="schema.placeholder ?? ''"
          [type]="schema.type ?? 'text'"
          [autofocus]="schema.autofocus"
          [readonly]="schema.readonly | reactive: model:schema:control"
          [nzSize]="schema.size!"
          [nzBorderless]="schema.borderless" />
      </ng-container>

      <ng-template #standardTemplate>
        <input
          nz-input
          [attr.id]="schema.id"
          [attr.name]="schema.key"
          [attr.maxlength]="helper.length.max | invoke: schema.length"
          [attr.minlength]="helper.length.min | invoke: schema.length"
          [fluentBinding]="{ schema, control }"
          [ngClass]="schema.class"
          [ngStyle]="schema.style"
          [formControl]="control"
          [placeholder]="schema.placeholder ?? ''"
          [type]="schema.type ?? 'text'"
          [autofocus]="schema.autofocus"
          [readonly]="schema.readonly | reactive: model:schema:control"
          [nzSize]="schema.size!"
          [nzBorderless]="schema.borderless" />
      </ng-template>
    </ng-template>
  </ng-container>
</ng-template>
